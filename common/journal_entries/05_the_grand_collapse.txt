je_the_grand_collapse = {
	
	group = je_group_historical_content
	icon = "gfx/interface/icons/event_icons/event_skull.dds"
	
	scripted_button = je_the_grand_collapse_bribe_politicians_button
	scripted_button = je_the_grand_collapse_issue_khutbah_button
	scripted_button = je_the_grand_collapse_law_speed_start_button
	scripted_button = je_the_grand_collapse_law_speed_stop_button
	scripted_button = je_the_grand_collapse_relation_speed_start_button
	scripted_button = je_the_grand_collapse_relation_Speed_stop_button
	
	should_be_pinned_by_default = yes
	weight = 10000
	
	is_shown_when_inactive = {
		always = no	# The JE is only ever referred to in this file, so we can do this to disable it, without causing errors elsewhere.
	}
	
	on_monthly_pulse = {
		random_events = {
			200 = 0
			20 = the_grand_collapse.2	#Any Port in a Storm
		}
	}
	
	possible = {
		always = no	# The JE is only ever referred to in this file, so we can do this to disable it, without causing errors elsewhere.
	}
	
	immediate = {
		custom_tooltip = ten_years_to_collapse_tt
		trigger_event = the_grand_collapse.1
		set_variable = grand_collapse_started
	}
	
	complete = {
		custom_tooltip = {
			text = is_not_in_civil_war_tt
			any_civil_war = {
				count = 0
			}
		}
		trigger_if = {
			limit = {
				is_player = yes
			}
			OR = {
				has_law_or_variant = law_type:law_monarchy
				has_law_or_variant = law_type:law_theocracy
			}
			radical_fraction = {
				value < 0.1
			}
			ig:ig_intelligentsia ?= {
				is_in_government = no
			}
		}
		government_legitimacy > 80
		trigger_if = {
			limit = {
				any_subject_or_below = {
					count > 0
				}
			}
			any_subject_or_below = {
				relations:root >= relations_threshold:cordial
			}
		}
		any_interest_group = {
			ig_approval >= happy
			count >= 3
		}
	}
	
	on_complete = {
		trigger_event = the_grand_collapse.4
		hidden_effect = {
			the_grand_collapse_mod_cleanser = yes
		}
	}
	
	event_outcome_completed_desc = {
		first_valid = {
			triggered_desc = {
				desc = event_effects_the_grand_collapse.4_tt
			}
		}
	}
	
	fail = {}
	
	on_fail = {}
	
	invalid = {
		any_scope_state = {
			NOT = {
				region = sr:region_anatolia
			}
			count = 0
		}
	}
	
	on_invalid = {}
	
	timeout = 3650
	
	on_timeout = {
		trigger_event = the_grand_collapse.5
		hidden_effect = {
			the_grand_collapse_mod_cleanser = yes
		}
	}
	
	event_outcome_timeout_desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_law = law_type:law_autocracy
				}
				desc = event_effects_the_grand_collapse.5_autocracy_tt
			}
			triggered_desc = {
				trigger = {
					NOT = {
						has_law = law_type:law_autocracy
					}
				}
				desc = event_effects_the_grand_collapse.5_tt
			}
		}
	}
}
