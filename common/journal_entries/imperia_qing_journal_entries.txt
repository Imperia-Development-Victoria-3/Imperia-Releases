##Qing Entries
je_chinese_national_identity = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	group = je_group_historical_content
	complete = {
		any_country = {
			filter = {
				OR = {
					country_has_primary_culture = cu:han
					country_has_primary_culture = cu:manchu
				}
			}
			has_technology_researched = nationalism
			percent >= 0.75
		}
		NOT = {
			has_law = law_type:law_no_schools
		}
		institution_investment_level = {
			institution = institution_schools
			value >= 2
		}
	}
	on_complete = {
		custom_tooltip = {
			text = linguistics_conference_tt
			set_variable = je_chinese_national_identity_completed
		}
	}
	invalid = {
		has_global_variable = china_shatters
	}
	weight = 1000
}

je_end_han_discrimination = {
	icon = "gfx/interface/icons/event_icons/event_fire.dds"
	group = je_group_historical_content
	modifiers_while_active = {
		modifier_han_second_class
	}
	complete = {
		has_law = law_type:law_cultural_exclusion
	}
	on_complete = {
		remove_modifier = modifier_anti_manchu_sentiment
		add_primary_culture = cu:han
		add_loyalists = {
			value = 0.1
			culture = cu:han
		}
		custom_tooltip = {
			text = fragile_unity_major_remove_tt
			set_variable = je_end_han_discrimination_completed
		}
	}
	fail = {
		custom_tooltip = {
			text = taiping_happened_tt
			has_variable = cant_discriminate_han
		}
	}
	on_fail = {
		remove_modifier = modifier_anti_manchu_sentiment
		custom_tooltip = {
			text = fragile_unity_major_add_tt
			set_variable = je_end_han_discrimination_failed
		}
		add_primary_culture = cu:han
		add_radicals = {
			value = 0.2
			culture = cu:han
		}
	}
	on_monthly_pulse = {
		random_events = {
			100 = 0
			3 = imperia_qing.2
		}
	}
	weight = 1000
}

je_qing_administrative_reform = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	group = je_group_historical_content
	complete = {
		AND = {
			institution_investment_level = {
				institution = institution_police
				value >= 3
			}
			has_law = law_type:law_dedicated_police
			bureaucracy >= 0
			approaching_bureaucracy_shortage = no
			has_technology_researched = central_archives
		}
	}
	on_complete = {
		add_modifier = modifier_baojia_system
		custom_tooltip = {
			text = fragile_unity_minor_remove_tt
			set_variable = je_qing_administrative_reform_completed
		}
		every_subject_or_below = {
			limit = {
				overlord = c:CHI
			}
			remove_modifier = modifier_provincial_disorder
		}
	}
	timeout = 14600
	on_timeout = {
		custom_tooltip = {
			text = fragile_unity_minor_add_tt
			set_variable = je_qing_administrative_reform_failed
		}
	}
	weight = 1000
}

je_end_female_infanticide = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	group = je_group_historical_content
	complete = {
		OR = {
			has_law = law_type:law_women_in_the_workplace
			has_law = law_type:law_womens_suffrage
		}
	}
	on_complete = {
		remove_modifier = modifier_female_shortage
	}
	weight = 1000
}

je_rural_poverty_qing = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	group = je_group_historical_content
	complete = {
		OR = {
			AND = {
				average_sol >= 10
				OR = {
					has_law = law_type:law_tenant_farmers
					has_law = law_type:law_commercialized_agriculture
				}
			}
			OR = {
				has_law = law_type:law_homesteading
				has_law = law_type:law_collectivized_agriculture
			}
		}
		NOR = {
			has_law = law_type:law_consumption_based_taxation
			has_law = law_type:law_land_based_taxation
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}
	on_complete = {
		remove_modifier = modifier_rural_poverty
		add_loyalists = {
			value = 0.1
		}
		custom_tooltip = {
			text = fragile_unity_major_remove_tt
			set_variable = je_rural_poverty_qing_completed
		}
	}
	timeout = 14600
	on_timeout = {
		add_radicals = {
			value = 0.1
		}
		custom_tooltip = {
			text = fragile_unity_major_add_tt
			set_variable = je_rural_poverty_qing_failed
		}
	}
	current_value = {
		value = var:rural_poverty_var
	}
	goal_add_value = {
		add = 3
	}
	immediate = {
		set_variable = {
			name = rural_poverty_var
			value = 0
		}
	}
	progressbar = yes
	weight = 1000
}

je_investigate_military_reform = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	immediate = {
		set_variable = {
			name = eight_banners_powerful_var
			value = 0
		}
	}
	complete = {
		has_technology_researched = line_infantry
		ig:ig_armed_forces = {
			ig_approval >= 10
			is_powerful = no
		}
	}
	on_complete = {
		add_journal_entry = {
			type = je_reform_the_banner_system_local
		}
		add_journal_entry = {
			type = je_reform_the_banner_system_modern
		}
	}
	fail = {
		custom_tooltip = {
			text = eight_banners_powerful_tt
			var:eight_banners_powerful_var > 24
		}
	}
	on_fail = {
		trigger_event = {
			id = imperia_qing.5
		}
	}
	current_value = {
		value = var:eight_banners_powerful_var
	}
	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					ig:ig_armed_forces = {
						is_powerful = yes
					}
				}
				change_variable = {
					name = eight_banners_powerful_var
					add = 1
				}
			}
		}
	}
	weight = 1000
}

je_reform_the_banner_system_local = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	complete = {
		AND = {
			army_size >= 50
			has_technology_researched = napoleonic_warfare
			OR = {
				has_law = law_type:law_national_guard
				has_law = law_type:law_localized_garrisons
				has_law = law_type:law_faith_orders
			}
			any_military_formation = {
				filter = {
					is_army = yes
				}
				any_combat_unit = {
					has_unit_type = unit_type:combat_unit_type_line_infantry
				}
				percent >= 0.75
			}
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}
	on_complete = {
		trigger_event = {
			id = imperia_qing.4
		}
		
		set_variable = chose_yong_ying
	}
	invalid = {
		NOT = {
			has_law = law_type:law_banner_system
		}
	}
	current_value = {
		value = var:yong_ying_var
	}
	goal_add_value = {
		add = 4
	}
	immediate = {
		set_variable = {
			name = yong_ying_var
			value = 0
		}
	}
	progressbar = yes
	weight = 1000
}

je_reform_the_banner_system_modern = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	complete = {
		AND = {
			army_size >= 150
			has_technology_researched = general_staff
			has_technology_researched = logistics
			has_technology_researched = rifling
			NOT = {
				any_scope_building = {
					is_building_type = building_barracks
					OR = {
						building_has_goods_shortage = yes
						has_active_production_method = pm_no_organization
					}
				}
			}
			any_military_formation = {
				filter = {
					is_army = yes
				}
				any_combat_unit = {
					has_unit_type = unit_type:combat_unit_type_skirmish_infantry
				}
				percent >= 0.75
			}
		}
	}
	on_complete = {
		trigger_event = {
			id = imperia_qing.4
		}
		set_variable = chose_new_army
	}
	invalid = {
		NOT = {
			has_law = law_type:law_banner_system
		}
	}
	weight = 1000
}

je_hundred_days_reform = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	group = je_group_historical_content
	scripted_button = je_hundred_days_reform_modernizer_conversion_button
	scripted_button = je_hundred_days_reform_enthusiasm_button
	scripted_button = je_hundred_days_reform_force_enactment_button
	# Progress Bar
	scripted_progress_bar = hundred_days_reform_enthusiasm_progress_bar
	modifiers_while_active = {
		qing_reforms_hundred_days_reform_momentum
	}
	is_shown_when_inactive = {
		root ?= c:CHI
		# Done this way to show it a bit earlier and more dynamically depending on conditions, requirements are still the same
		calc_true_if = {
			amount >= 4
			year >= 1880
			ruler = {
				age >= define:NCharacters|ADULT_AGE
			}
			ruler = {
				OR = {
					has_ideology = ideology:ideology_modernizer_leader
					# Will rapidly spit errors if this is used directly on a character while the JE is not triggered... 
					# Looks a bit uggo, but better than 1000 errors a second
					interest_group = {
						NOT = {
							is_interest_group_type = ig_landowners
						}
					}
				}
			}
			has_law = law_type:law_monarchy
			has_journal_entry = je_warlord_china
		}
	}
	possible = {
		year >= 1880
		ruler = {
			age >= define:NCharacters|ADULT_AGE
			OR = {
				has_ideology = ideology:ideology_modernizer_leader
				interest_group = {
					NOT = {
						is_interest_group_type = ig_landowners
					}
				}
			}
		}
		has_law = law_type:law_monarchy
		has_journal_entry = je_warlord_china
	}
	complete = {
		# Promote Capitalism (Interventionism or Laissez Faire, Protectionism, Commercialized Agriculture)
		custom_tooltip = {
			text = concept_qing_reform_promote_capitalism_tt
			AND = {
				OR = {
					has_law = law_type:law_interventionism
					has_law = law_type:law_laissez_faire
				}
				has_law = law_type:law_protectionism
				has_law = law_type:law_commercialized_agriculture
			}
		}
		# Adopt Modern Military Training (army has repeaters or bolt-actions activated and advanced tactics training)
		custom_tooltip = {
			text = concept_qing_reform_adopt_modern_military_tt
			AND = {
				OR = {
					army_mobilization_option_fraction = {
						target = mobilization_option:mobilization_option_repeaters
						value >= 0.8
					}
					army_mobilization_option_fraction = {
						target = mobilization_option:mobilization_option_bolt_actions
						value >= 0.8
					}
				}
				# And advanced tactics training for 80% of army
				any_scope_building = {
					filter = {
						is_building_type = building_barracks
					}
					has_active_production_method = pm_advanced_tactics_training
					percent = 0.8
				}
			}
		}
		# Establish a constitution (wealth, census or universal suffrage)
		custom_tooltip = {
			text = concept_qing_reform_adopt_constitution_tt
			OR = {
				has_law = law_type:law_wealth_voting
				has_law = law_type:law_census_voting
				has_law = law_type:law_universal_suffrage
			}
		}
		# Standardize the Chinese Language (Establish National Language JE completion, either has Prestige Dialect or supported Prestige Dialect modifier.)
		custom_tooltip = {
			text = concept_qing_reform_standardize_language_tt
			OR = {
				has_modifier = modifier_prestige_dialect
				has_modifier = modifier_accepted_prestige_dialect
			}
		}
		# Abolish 'Booi Aha'
		custom_tooltip = {
			text = concept_qing_reform_abolish_boii_aha_tt
			NOT = {
				has_law = law_type:law_booi_aha
			}
		}
		custom_tooltip = {
			text = je_hundred_days_reform_100_enthusiasm_tt
			scope:journal_entry ?= {
				"scripted_bar_progress(hundred_days_reform_enthusiasm_progress_bar)" >= 100
			}
		}
	}
	on_complete = {
		custom_tooltip = {
			text = fragile_unity_significant_remove_tt
			set_variable = je_hundred_days_reform_completed
		}
		if = {
			limit = {
				has_journal_entry = je_earn_recognition
			}
			je:je_earn_recognition ?= {
				add_progress = {
					value = 100
					name = earn_recognition_progress_bar
				}
			}
		}
		else = {
			custom_tooltip = 100_progress_on_recognition_if_je_active_tt
		}
	}
	fail = {
		custom_tooltip = {
			text = je_hundred_days_reform_0_enthusiasm_tt
			scope:journal_entry ?= {
				"scripted_bar_progress(hundred_days_reform_enthusiasm_progress_bar)" <= 0
			}
		}
	}
	on_fail = {
		custom_tooltip = {
			text = fragile_unity_significant_add_tt
			set_variable = je_hundred_days_reform_failed
		}
		add_modifier = {
			name = qing_reforms_hundred_days_reform_momentum
			years = 20
		}
		if = {
			limit = {
				NOT = {
					has_law = law_type:law_autocracy
				}
			}
			activate_law = law_type:law_autocracy
		}
	}
	on_monthly_pulse = {
		random_events = {
			chance_of_no_event = 75
			1 = imperia_hundred_days.1	# Literary War
			1 = imperia_hundred_days.2	# Malicious Compliance
			1 = imperia_hundred_days.3	# Foreign Gaze
			1 = imperia_hundred_days.4	# Student Reformists
			1 = imperia_hundred_days.5	# Question of the Imperial Examination
			1 = imperia_hundred_days.6	# The [intel_leader] Affair
			1 = imperia_hundred_days.7	# A Whiff of Weakness
		}
	}
	weight = 1000
	should_be_pinned_by_default = yes
}

##Local Entries
je_establish_local_armies = {
	#Common
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	complete = {
		army_size >= 50
		has_technology_researched = napoleonic_warfare
		OR = {
			has_law = law_type:law_national_guard
			has_law = law_type:law_localized_garrisons
			has_law = law_type:law_faith_orders
		}
		NOT = {
			any_scope_building = {
				is_building_type = building_barracks
				OR = {
					building_has_goods_shortage = yes
					has_active_production_method = pm_no_organization
				}
			}
		}
	}
	on_complete = {
		if = {
			limit = {
				exists = c:CHI
				is_subject_of = c:CHI
			}
			c:CHI ?= {
				change_variable = {
					name = yong_ying_var
					add = 1
				}
			}
		}
		activate_law = law_type:law_peasant_levies
	}
	fail = {
		NOT = {
			exists = c:CHI
		}
	}
	on_fail = {
		activate_law = law_type:law_peasant_levies
	}
	invalid = {
		OR = {
			has_global_variable = china_shatters
			NOT = {
				has_law = law_type:law_banner_system
			}
		}
		
	}
	weight = 1000
}

je_rural_poverty_substate = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"
	group = je_group_historical_content
	complete = {
		NOT = {
			has_law = law_type:law_serfdom
		}
		NOR = {
			has_law = law_type:law_consumption_based_taxation
			has_law = law_type:law_land_based_taxation
		}
	}
	on_complete = {
		remove_modifier = modifier_rural_poverty
		add_loyalists = {
			value = 0.1
		}
		if = {
			limit = {
				exists = c:CHI
				is_subject_of = c:CHI
			}
			c:CHI = {
				change_variable = {
					name = rural_poverty_var
					add = 1
				}
			}
		}
	}
	weight = 1000
}

je_industrialize_china = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	group = je_group_historical_content
	complete = {
		OR = {
			any_scope_state = {
				filter = {
					is_incorporated = yes
				}
				any_scope_building = {
					is_building_type = building_urban_center
					level >= 20
				}
				percent > 0.75
			}
			pop_type_percent_country = {
				pop_type = peasants
				percent < 0.35
			}
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_great_leap_forward
			months = 120
		}
	}
	weight = 1000
}

je_promote_western_learning = {
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	group = je_group_historical_content
	complete = {
		has_technology_researched = dialectics
		any_scope_building = {
			is_building_type = building_university
			occupancy > 0.9
			level >= 5
		}
		NOT = {
			has_law = law_type:law_no_schools
		}
		institution_investment_level = {
			institution = institution_schools
			value >= 2
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_self_strengthening_movement
			months = 120
		}
	}
	weight = 1000
}

##Substate-Specific
je_pacify_highland_tribes = {
	#Sichuan
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	modifiers_while_active = {
		modifier_tusi_system
	}
	complete = {
		AND = {
			institution_investment_level = {
				institution = institution_police
				value >= 2
			}
			has_law = law_type:law_dedicated_police
			NOR = {
				has_law = law_type:law_traditionalism
				has_law = law_type:law_localized_garrisons
			}
			bureaucracy >= 0
			approaching_bureaucracy_shortage = no
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_tusi_system
			days = long_modifier_time
			is_decaying = yes
		}
		trigger_event = {
			id = imperia_qing_substates.2
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_remove_tt
				set_variable = je_pacify_highland_tribes_completed
			}
		}
	}
	on_monthly_pulse = {
		random_events = {
			100 = 0
			3 = imperia_qing_substates.3
			3 = imperia_qing_substates.4
			3 = imperia_qing_substates.5
		}
	}
	weight = 5000
	should_be_pinned_by_default = yes
}

je_gateway_to_the_west = {
	#Liangguang
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	group = je_group_historical_content
	complete = {
		AND = {
			any_scope_building = {
				is_building_type = building_port
				level >= 10
			}
			has_law = law_type:law_free_trade
			NOR = {
				has_law = law_type:law_traditionalism
				has_law = law_type:law_agrarianism
			}
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_gateway_to_the_west
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_add_tt
				set_variable = je_gateway_to_the_west_completed
			}
		}
	}
	weight = 5000
	should_be_pinned_by_default = yes
}

je_breadbasket_of_the_south = {
	#Huguang
	icon = "gfx/interface/icons/event_icons/event_newspaper.dds"
	group = je_group_historical_content
	modifiers_while_active = {
		modifier_breadbasket_of_the_south
	}
	complete = {
		pop_type_percent_country = {
			pop_type = peasants
			percent < 0.6
		}
		OR = {
			has_law = law_type:law_interventionism
			has_law = law_type:law_laissez_faire
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_breadbasket_of_the_south
			days = long_modifier_time
			is_decaying = yes
		}
		ig:ig_landowners = {
			remove_ideology = ideology_huguang_agrarian_idyll
			add_ideology = ideology_scholar_paternalistic
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_add_tt
				set_variable = je_breadbasket_of_the_south_completed
			}
		}
	}
	weight = 5000
	should_be_pinned_by_default = yes
}

je_settle_the_steppe = {
	#Eastern Provinces
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	group = je_group_historical_content
	scripted_button = manchuria_migration_button
	modifiers_while_active = {
		modifier_chuang_guandong
	}
	complete = {
		total_population > 12000000
		has_law = law_type:law_cultural_exclusion
		s:STATE_SHENGJING.region_state:MCH ?= {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 5
			}
		}
		s:STATE_SOUTHERN_MANCHURIA.region_state:MCH ?= {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 5
			}
		}
		s:STATE_NORTHERN_MANCHURIA.region_state:MCH ?= {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 5
			}
		}
	}
	on_complete = {
		trigger_event = {
			id = imperia_qing_substates.13
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_add_tt
				set_variable = je_settle_the_steppe_completed
			}
		}
	}
	weight = 5000
	should_be_pinned_by_default = yes
}

je_pacify_and_settle_taiwan = {
	#Formosa
	icon = "gfx/interface/icons/event_icons/event_industry.dds"
	group = je_group_historical_content
	complete = {
		pop_type_percent_country = {
			pop_type = peasants
			percent < 0.35
		}
		s:STATE_FORMOSA.region_state:FRS = {
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 10
			}
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}
	on_complete = {
		add_modifier = {
			name = modifier_qing_new_frontiers
			months = 240
			is_decaying = yes
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_remove_tt
				set_variable = je_pacify_and_settle_taiwan_completed
			}
		}
	}
	current_value = {
		value = root.gdp
	}
	goal_add_value = {
		value = root.gdp
		multiply = 2
	}
	progressbar = yes
	weight = 5000
	should_be_pinned_by_default = yes
}

je_silk_march = {
	#Gansu
	icon = "gfx/interface/icons/event_icons/event_military.dds"
	group = je_group_historical_content
	modifiers_while_active = {
		modifier_weathered_march
	}
	complete = {
		AND = {
			OR = {
				has_law = law_type:law_national_guard
				has_law = law_type:law_localized_garrisons
			}
			AND = {
				has_company = company_type:company_gansu_military_farms
				any_company = {
					AND = {
						is_company_type = company_type:company_gansu_military_farms
						company_is_prosperous = yes
					}
					
				}
			}
			bureaucracy >= 0
			approaching_bureaucracy_shortage = no
		}
	}
	on_complete = {
		every_state = {
			limit = {
				OR = {
					state_region = s:STATE_GANSU
					state_region = s:STATE_NINGXIA
				}
			}
			add_modifier = modifier_silk_march
		}
		remove_company = company_type:company_gansu_military_farms
		custom_tooltip = {
			text = shaan_gan_dev_company_tt
		}
		c:CHI ?= {
			custom_tooltip = {
				text = fragile_unity_minor_remove_tt
				set_variable = je_silk_march_completed
			}
		}
	}
	weight = 5000
	should_be_pinned_by_default = yes
}
